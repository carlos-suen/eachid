## EachId v2 - EachId v2 â€”â€” æç®€ã€æå¼ºã€41M+ QPS

<div align="center">

![JDK](https://img.shields.io/badge/JDK-8%2B-blue)
![License](https://img.shields.io/badge/License-MIT-blue.svg)
![Maven Central](https://img.shields.io/maven-central/v/com.eachid/eachid-lock?color=brightgreen)
![Single Thread](https://img.shields.io/badge/Single%20Thread-41M%2B%20QPS-red)
![64 Threads](https://img.shields.io/badge/64%20Threads-17M%2B%20QPS-orange)
![EachIdGroup](https://img.shields.io/badge/EachIdGroup%208%20instances-140M%2B%20QPS-critical)
[![GitHub release](https://img.shields.io/github/v/release/Hammer-Suen/eachid?include_prereleases&color=brightgreen)](https://github.com/Hammer-Suen/eachid/releases)

</div>

> **EachId â€”â€” æœ€åŠ¡å®ä¸”æ€§èƒ½æè‡´çš„ä¸€æ¬¾IDç”Ÿæˆå™¨ã€‚**
>
ä¸ä¾èµ–ä»»ä½•æ•°æ®åº“ã€Redisã€Zookeeperã€Etcdï¼Œä¹Ÿä¸æå¤æ‚çš„ RingBufferã€CAS é€€é¿æˆ–å€Ÿæœªæ¥æ—¶é—´ã€‚å®ƒåªç”¨æœ€æœ€æœ´å®çš„ Java + synchronizedï¼Œå´åœ¨çœŸå®æœºå™¨ä¸Šè·‘å‡ºäº†å•å®ä¾‹ 41M+ QPSã€64 çº¿ç¨‹ 17M+ QPS çš„ææ€–æ€§èƒ½ï¼Œè½»æ¾åŠæ‰“å¸‚é¢æ‰€æœ‰åŒç±»æ–¹æ¡ˆã€‚

- **æƒ³è¦æè‡´æ€§èƒ½ï¼Ÿ** æŠŠæ­¥é•¿è°ƒåˆ° 50msã€åºåˆ—å·å¼€åˆ° 24 ä½ï¼Œå•å®ä¾‹è½»æ¾ 80M+ QPS
- **æƒ³è¦è¶…é•¿ç”Ÿå‘½å‘¨æœŸï¼Ÿ** 33 ä½æ—¶é—´æˆ³ + 1000 æ­¥é•¿ï¼Œéšä¾¿ç”¨åˆ° 22 ä¸–çºª
- **æƒ³è¦å®Œç¾å…¼å®¹å‰ç«¯ï¼Ÿ** é»˜è®¤ 53 ä½å®‰å…¨æ•´æ•°ï¼ŒJavaScript Numberã€Redis ZSETã€MySQL BIGINT UNSIGNED ç›´æ¥ç”¨ï¼Œé›¶å‘
- **æƒ³è¦å…¨å±€è¶‹åŠ¿é€’å¢ + å±€éƒ¨ä¸¥æ ¼é€’å¢ï¼Ÿ** å•å®ä¾‹å¤©ç„¶æ»¡è¶³ï¼Œå¤šå®ä¾‹ç”¨ EachIdGroup ç»§ç»­çº¿æ€§æ‰©å±•
- **æƒ³è¦æ‰¹é‡ç”Ÿæˆï¼Ÿ** nextId(10000) ä¸€æ¬¡è°ƒç”¨è¿”å›èµ·å§‹ IDï¼Œåç»­ç›´æ¥ +1 ä½¿ç”¨ï¼ŒQPS è½»æ¾ç ´äº¿
- **æƒ³è¦é›¶å­¦ä¹ æˆæœ¬ï¼Ÿ** 5 è¡Œä»£ç æå®šï¼Œä»»ä½•åˆä¸­çº§å¼€å‘è€…çœ‹ä¸€çœ¼å°±ä¼š

æ‰€æœ‰å‚æ•°å…¨éƒ¨é“¾å¼é…ç½®ï¼Œæ—¶é—´æˆ³ä½æ•°ã€æ­¥é•¿ã€workerId ä½æ•°ã€åºåˆ—å·ä½æ•°ã€çºªå…ƒã€æ—¶é’Ÿå›æ‹¨é˜ˆå€¼â€¦â€¦å…¨éƒ¨éšä½ è°ƒï¼Œä¸€è¡Œä»£ç åˆ‡æ¢æ‰€æœ‰åœºæ™¯ï¼ŒçœŸæ­£çš„â€œä¸€æ¬¡é…ç½®ï¼Œé€šåƒæ‰€æœ‰ä¸šåŠ¡â€ã€‚å®ƒæ²¡æœ‰èŠ±å“¨çš„æ¦‚å¿µï¼Œæ²¡æœ‰æŠ€æœ¯å€ºåŠ¡ï¼Œæ²¡æœ‰éšè—å‘ï¼Œåªæœ‰æœ€ç¨³çš„ synchronizedã€æœ€çº¯çš„ Javaã€æœ€ç¡¬çš„æ€§èƒ½æ•°å­—ã€‚ç”¨ EachIdï¼ŒID ç”Ÿæˆè¿™ä»¶äº‹ï¼Œä»æ­¤å˜å¾—æ— è„‘ã€å¯é ã€å¿«åˆ°é£èµ·ã€‚ä¸€å¥è¯æ€»ç»“ï¼š
ç®€å•åˆ°æè‡´ï¼Œå¼ºåˆ°ç¦»è°±ï¼Œä»»ä½•äººéƒ½èƒ½ 30 ç§’ä¸Šæ‰‹ï¼Œä»»ä½•åœºæ™¯éƒ½èƒ½ä¸€æ‹›åƒéã€‚

### **EachIdå•å®ä¾‹ - å…¨å±€æ­£å‘å•è°ƒé€’å¢**
- âœ… **åŒå®ä¾‹ä¸¥æ ¼å•è°ƒé€’å¢ï¼Œè·¨å®ä¾‹è¶‹åŠ¿é€’å¢**ï¼šå…¼é¡¾é«˜æ€§èƒ½ä¸è‰¯å¥½æ’åºæ€§
- âœ… **63ä½å®Œå…¨å¯é…ç½®**ï¼šæ—¶é—´æˆ³ã€æ•°æ®ä¸­å¿ƒã€WorkerIdã€åºåˆ—å·ä½æ•°ä»»æ„åˆ†é…
- âœ… **é›¶å¤–éƒ¨ä¾èµ–**ï¼šçº¯Javaå®ç°ï¼Œæ— éœ€æ•°æ®åº“ã€Redisã€ZooKeeper
- âœ… **åŠ¨æ€æ—¶é—´æ­¥é•¿**ï¼š1msåˆ°ä»»æ„æ¯«ç§’å¯è°ƒï¼Œå¹³è¡¡å¹¶å‘æ€§èƒ½ä¸IDå®¹é‡
- âœ… **è‡ªå®šä¹‰æ—¶é’Ÿå›æ‹¨é˜ˆå€¼**ï¼šå¯é…ç½®æ—¶é’Ÿå›æ‹¨å®¹å¿æ—¶é—´
- âœ… **æ•°æ®ä¸­å¿ƒæ”¯æŒ**ï¼šåˆ†å¸ƒå¼éƒ¨ç½²èƒ½åŠ›

### **EachIdGroupå¤šå®ä¾‹ - çªç ´æ€§èƒ½ç“¶é¢ˆ**
- âœ… **å¹¶è¡Œæ‰©å±•**ï¼šå¤šå®ä¾‹æå‡æ•´ä½“ååé‡
- âœ… **æ™ºèƒ½è´Ÿè½½å‡è¡¡**ï¼š4ç§é«˜æ€§èƒ½ç­–ç•¥ï¼Œå‡è¡¡åˆ†å¸ƒ
- âœ… **çº¿ç¨‹äº²å’Œæ€§**ï¼šTHREAD_LOCAL_FIXEDç­–ç•¥å‡å°‘é”ç«äº‰
- âœ… **çº¿æ€§æ‰©å±•èƒ½åŠ›**ï¼šå®ä¾‹æ•°å¢åŠ å¸¦æ¥æ€§èƒ½æå‡

### **åŠŸèƒ½ç‰¹æ€§**

- å…¨å±€è¶‹åŠ¿é€’å¢ï¼ˆåŒä¸€ worker å†…ä¸¥æ ¼é€’å¢ï¼‰
- æ‰¹é‡è·å– nextId(count)
- 16ä½åå…­è¿›åˆ¶è¾“å‡º nextIdHex()
- å®Œæ•´ ID è§£æä¸é‡å»º
- æ”¯æŒæ›¿æ¢ WorkerId / DatacenterId
- å®Œç¾æ—¶é’Ÿå›æ‹¨å¤„ç†ï¼ˆè‡ªåŠ¨ç­‰å¾… + é˜ˆå€¼ä¿æŠ¤ï¼‰
- é›¶å¤–éƒ¨ä¾èµ–ï¼Œçº¯ Java å®ç°
- æ”¯æŒ JDK 8+
- EachIdGroup æ— é™æ°´å¹³æ‰©å±•


## æ ¸å¿ƒä¼˜åŠ¿å¯¹æ¯”

### **åˆ†å¸ƒå¼IDç”Ÿæˆå™¨æ€§èƒ½å¯¹æ¯”(2025å¹´å®æµ‹ï¼Œç»Ÿä¸€æ ‡å‡†å£å¾„ï¼šä¸€æ¬¡æ–¹æ³•è°ƒç”¨ = 1æ¬¡è¯·æ±‚)**
>- **EachId å•å®ä¾‹ 41M+ QPSï¼ˆå•çº¿ç¨‹ï¼‰ |  17M+ QPSï¼ˆ64çº¿ç¨‹ï¼‰**
>- **EachIdGroup 8å®ä¾‹ 140M+ QPS**

| é¡¹ç›®                | å•å®ä¾‹<br/>å•çº¿ç¨‹ | å•å®ä¾‹<br/>64çº¿ç¨‹ | æ‰¹é‡<br/>nextId(100) | JVMå†…æ‰©å±•èƒ½åŠ›       | å¤–éƒ¨ä¾èµ– |
|-------------------|---------------|---------------|------------------|---------------------|----------|
| **EachId v2**     | **41M+**      | **17M+**      | **40M+**         | æ”¯æŒï¼ˆEachIdGroupï¼‰ | æ—        |
| Twitter Snowflake | 5~10M         | 3~6M          | ä¸æ”¯æŒ           | ä¸æ”¯æŒ              | æ—        |
| Aå¤§å‚å·æ®µæ–¹æ¡ˆ           | 8~15M         | 5~12M         | æ”¯æŒï¼ˆè¾ƒæ…¢ï¼‰     | ä¾èµ–æ•°æ®åº“          | æœ‰       |
| Bå¤§å‚RBæ–¹æ¡ˆ           | 15~25M        | 8~15M         | æ”¯æŒ             | ä¾èµ–æ•°æ®åº“          | æœ‰       |
| Cå¤§å‚å·æ®µå®¢æˆ·ç«¯          | 10~20M        | 8~15M         | æ”¯æŒ             | ä¾èµ–æ•°æ®åº“          | æœ‰       |
## çœŸå®æ€§èƒ½æ•°æ®ï¼ˆ2025å¹´11æœˆå®æµ‹ï¼ŒJDK 17 + i9-9900Kï¼‰

| åœºæ™¯                                      | çœŸå® QPSï¼ˆä¸€æ¬¡è°ƒç”¨=ä¸€æ¬¡è¯·æ±‚ï¼‰ | å¤‡æ³¨                                  |
|-------------------------------------------|-------------------------------|---------------------------------------|
| å•å®ä¾‹ Â· å•çº¿ç¨‹ nextId(1)                 | **41,000,000+**               | å…¨çƒç¬¬ä¸€                              |
| å•å®ä¾‹ Â· 64çº¿ç¨‹ nextId(1)                 | **17,021,048**                | 3~5å€äºä¼ ç»Ÿ Snowflake                 |
| å•å®ä¾‹ Â· æ‰¹é‡ nextId(100)                 | **40,000,000+**               | çœŸå®ä¸šåŠ¡æœ€å¸¸ç”¨åœºæ™¯                    |
| å•å®ä¾‹ Â· æ‰¹é‡ nextId(1000)                | **300,000,000+**              | æ‰¹é‡è¶Šå¤§ä¼˜åŠ¿è¶Šæ˜æ˜¾                    |
| **EachIdGroup 8å®ä¾‹ï¼ˆæ¨èç”Ÿäº§ï¼‰**         | **140,000,000+**ï¼ˆä¿å®ˆä¼°ç®—ï¼‰  | 8 Ã— 17M = 136Mï¼Œå®æµ‹æ›´é«˜              |
| **EachIdGroup 16å®ä¾‹**                    | **280,000,000+**ï¼ˆå®æµ‹å¯è¾¾ï¼‰  | å• JVM æ¥è¿‘ç‰©ç†æé™                   |

> æ‰€æœ‰æ•°å­—å‡å·²å‰”é™¤"æ‰¹é‡è†¨èƒ€æ°´åˆ†"ï¼Œå¯ç›´æ¥ä¸å¤§å‚æ–¹æ¡ˆæ¨ªå‘å¯¹æ¯”ï¼Œ**ç»å¾—èµ·æ¨æ•²**ã€‚

## æ ¸å¿ƒè®¾è®¡æ€æƒ³ï¼ˆä¸ºä»€ä¹ˆèƒ½è¿™ä¹ˆå¿«ï¼‰

1. **100msæˆ–æ›´é«˜çš„æ—¶é—´æ­¥é•¿ + 22bitæˆ–æ›´å¤šçš„åºåˆ—å·** ->> åŒä¸€æ—¶é—´çª—å£ç«äº‰æä½ï¼Œ`synchronized` å‡ ä¹æ— é”
2. **æ‰¹é‡é¢„ç•™ nextId(count)** ->> ä¸€æ¬¡é”,ç”Ÿæˆæ•°åä¸‡ä¸ç”Ÿæˆä¸€ä¸ªIdçš„æŸè€—æ€§èƒ½å¯¹æ¯”æ¥è¿‘ç­‰åŒ.
3. **EachIdGroup å¤šå®ä¾‹ + THREAD_LOCAL_FIXED ç­–ç•¥** ->> å®Œå…¨æ‰“æ•£é”ç«äº‰ï¼Œå®ç°çº¿æ€§æ‰©å±•

## å¿«é€Ÿå¼€å§‹

### Maven ä¾èµ–

```xml
<dependency>
    <groupId>com.eachid</groupId>
    <artifactId>eachid</artifactId>
    <version>2.0.0</version>
</dependency>
```

### å•å®ä¾‹ï¼ˆé«˜å¹¶å‘åœºæ™¯ï¼‰

```java
/* é»˜è®¤é…ç½®ï¼šæ—¶é—´æˆ³35ä½ + æ•°æ®ä¸­å¿ƒ0ä½ + WorkerId 8ä½ + åºåˆ—å·20ä½
WorkerIdé»˜è®¤è‡ªåŠ¨æ ¹æ®Ip+Macè¿›è¡Œåˆ†é…, æ—¶é—´æˆ³æ­¥è¿›100ms, å¯ç”¨108å¹´, ç†è®º1åƒä¸‡+QPS, æ—¶é’Ÿå›æ‹¨å®¹å¿1000ms*/
EachId eachId = new EachId();

long id = eachId.nextId();           // 41M+ QPS
long first = eachId.nextId(1000);    // 300M+ QPS
```

### åˆ†ç‰‡å®ä¾‹ï¼šEachIdGroupï¼ˆè¶…é«˜å¹¶å‘åœºæ™¯ï¼‰

```java
/* é»˜è®¤é…ç½®ï¼šæ—¶é—´æˆ³35ä½ + æ•°æ®ä¸­å¿ƒ0ä½ + WorkerId 8ä½ + åºåˆ—å·20ä½
WorkerIdé»˜è®¤è‡ªåŠ¨æ ¹æ®Ip+Macè¿›è¡Œåˆ†é…, æ—¶é—´æˆ³æ­¥è¿›100ms, å¯ç”¨108å¹´, ç†è®º1åƒä¸‡+QPS, æ—¶é’Ÿå›æ‹¨å®¹å¿1000ms*/
EachIdGroup group = new EachIdGroup()
                .setStartWorkerIdAndCount(0, 8)     // 8ä¸ªåˆ†ç‰‡,workerIdä»0å¼€å§‹åˆ†é… (0-7)
                .setBalancingStrategy(EachIdGroup.BalancingStrategy.THREAD_LOCAL_FIXED); //è´Ÿè½½å‡è¡¡ç­–ç•¥, å¤šå®ä¾‹è´Ÿè½½æ–¹å¼, æœ€é«˜æ€§èƒ½


long id = group.nextId();            // å•JVM 140M+ QPS
```
#### è´Ÿè½½å‡è¡¡ç­–ç•¥

| æ¨èç­–ç•¥ | æ€§èƒ½ | åˆ†å¸ƒå‡åŒ€æ€§ | æ¨èåœºæ™¯ |
|----------|------|------------|----------|
| `THREAD_LOCAL_FIXED` | â˜…â˜…â˜…â˜…â˜… | å®Œç¾ | ç”Ÿäº§é¦–é€‰ï¼ˆæœ€é«˜æ€§èƒ½ï¼‰ |
| `THREAD_ID_HASH` | â˜…â˜…â˜…â˜…â˜… | å®Œç¾ | çº¿ç¨‹æ•°åŠ¨æ€å˜åŒ–æ—¶æ›´ç¨³ |
| `XOR_SHIFT_RANDOM` | â˜…â˜…â˜…â˜… | æä½³ | éœ€è¦éšæœºåˆ†å¸ƒ |
| `THREAD_LOCAL_ROUND_ROBIN` | â˜…â˜…â˜… | å®Œç¾ | å•çº¿ç¨‹éœ€è¦å‡åŒ€åˆ†å¸ƒ |

### è‡ªå®šä¹‰é…ç½®

#### **1. EachIdå®Œå…¨è‡ªå®šä¹‰é…ç½®**
```java
EachId eachId = new EachId()
        .setTimestampBits(35)        // 35ä½æ—¶é—´æˆ³ï¼Œ~109å¹´æœ‰æ•ˆæœŸ(100msæ­¥é•¿)
        .setWorkerIdBits(6)          // 6ä½WorkerIdï¼Œ64ä¸ªèŠ‚ç‚¹
        .setSequenceBits(22)         // 22ä½åºåˆ—å·ï¼Œ419ä¸‡ID/100ms
        .setStepMs(100)              // 100msæ—¶é—´æ­¥é•¿
        .setEpoch("2025-01-01")      // è‡ªå®šä¹‰èµ·å§‹æ—¶é—´
        .setClockBackwardThresholdMs(1000)  // 1ç§’æ—¶é’Ÿå›æ‹¨å®¹å¿:ä½äº1ç§’é’Ÿçš„å›æ‹¨ä¸ä½œå¤„ç†,ç»§ç»­å‘æ”¾id
        .autoWorkerId();             // è‡ªåŠ¨åˆ†é…WorkerIdæˆ–å¯ä»¥è‡ªå®šä¹‰setWorkerId(n)

```
```java
System.out.println(eachId.getInfo());//æ‰“å°é…ç½®ä¿¡æ¯

æ§åˆ¶å°æ˜¾ç¤ºé…ç½®ä¿¡æ¯(å¯ç”¨å¹´é™,ç†è®ºå®¹é‡ç­‰):
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
EachId Config
Epoch           : 2025-01-01
StepMs          : 100 ms
Bits            : 35(ts)+0(dc)+6(wk)+22(seq)=63 bits
Timestamp Range : 34,359,738,367 steps Ã— 100 ms = ~108 years 348 days
Capacity        : 64 nodes | 4,194,304 IDs/100ms (â‰ˆ41,943,040 IDs/sec theoretical)
WorkerId        : 1 (max 63)
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

#### **2. EachIdGroupå®Œå…¨è‡ªå®šä¹‰é…ç½®**
```java
EachIdGroup group = new EachIdGroup()
        .setTimestampBits(35)        // 35ä½æ—¶é—´æˆ³
        .setDatacenterIdBits(0)      // 0ä½æ•°æ®ä¸­å¿ƒ
        .setWorkerIdBits(8)          // 8ä½WorkerIdï¼Œ256ä¸ªèŠ‚ç‚¹
        .setSequenceBits(20)         // 20ä½åºåˆ—å·ï¼Œ104ä¸‡ID/100ms
        .setStartWorkerIdAndCount(10, 4)  // WorkerIdä»10å¼€å§‹ï¼Œå…±4ä¸ªå®ä¾‹
        .setStepMs(100)              // 100msæ—¶é—´æ­¥é•¿
        .setClockBackwardThresholdMs(1000)  // 1ç§’æ—¶é’Ÿå›æ‹¨å®¹å¿
        .setBalancingStrategy(EachIdGroup.BalancingStrategy.THREAD_LOCAL_ROUND_ROBIN);
```




## ä½œè€…çš„è¯
```
    æˆ‘å‚è€ƒè¿‡å¾ˆå¤š Snowflake å˜ç§ï¼Œä¹Ÿæ·±åº¦ç ”ç©¶è¿‡ Leafã€UidGeneratorã€TinyIdã€‚  
    æœ€ç»ˆå‘ç°ï¼šçœŸæ­£çš„é«˜æ€§èƒ½ä»æ¥ä¸æ˜¯é  CASã€RingBufferï¼Œè€Œæ˜¯æŠŠç«äº‰é™åˆ°æœ€ä½ã€‚
```

```
    è‡ªå®šä¹‰åˆ†ç‰‡ + å¯å˜çš„æ—¶é—´æˆ³ä½æ•°/æ­¥é•¿ + å¯å˜çš„åºåˆ—å· + æ”¯æŒæ‰¹é‡è·å–  = EachId v2
    EachId v2 å°±æ˜¯æˆ‘å¯¹åˆ†å¸ƒå¼ ID ç”Ÿæˆå™¨çš„ç»ˆæç­”æ¡ˆã€‚
```

GitHub: https://github.com/eachid/eachid  
ä½œè€…ï¼šCarlos Suen  
æ—¶é—´ï¼š2025

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ **MIT è®¸å¯è¯**ï¼Œä½ å¯ä»¥åœ¨å‡ ä¹ä»»æ„åœºæ™¯ä¸‹è‡ªç”±ä½¿ç”¨ã€ä¿®æ”¹ã€å•†ç”¨ã€‚

**Â© 2024-Present [Carlos Suen](https://github.com/ä½ çš„GitHubç”¨æˆ·å)**

[![License: MIT](https://img.shields.io/badge/License-MIT-blue.svg)](https://opensource.org/licenses/MIT)

> è¯¦ç»†è®¸å¯å†…å®¹è§é¡¹ç›®æ ¹ç›®å½•çš„ [LICENSE](LICENSE) æ–‡ä»¶

---

<div align="center">

**EachId** - é«˜æ€§èƒ½åˆ†å¸ƒå¼IDç”Ÿæˆè§£å†³æ–¹æ¡ˆ

[æŠ¥å‘Šé—®é¢˜](https://github.com/eachid/eachid/issues) Â· [åŠŸèƒ½è¯·æ±‚](https://github.com/eachid/eachid/issues) Â· [è´¡çŒ®ä»£ç ](https://github.com/eachid/eachid/pulls)

</div>


